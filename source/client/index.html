<!DOCTYPE html>
<html>
<head lang="en">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script>
        /*
         jQuery-GetPath v0.01, by Dave Cardwell. (2007-04-27)

         http://davecardwell.co.uk/javascript/jquery/plugins/jquery-getpath/

         Copyright (c)2007 Dave Cardwell. All rights reserved.
         Released under the MIT License.


         Usage:
         var path = $('#foo').getPath();
         */

        jQuery.fn.extend({
            getPath: function( path ) {
                // The first time this function is called, path won't be defined.
                if ( typeof path == 'undefined' ) path = '';

                // If this element is <html> we've reached the end of the path.
                if ( this.is('html') )
                    return 'html' + path;

                // Add the element name.
                var cur = this.get(0).nodeName.toLowerCase();

                // Determine the IDs and path.
                var id    = this.attr('id'),
                        cls = this.attr('class');


                // Add the #id if there is one.
                if ( typeof id != 'undefined' )
                    cur += '#' + id;

                // Add any classes.
                if ( typeof cls != 'undefined' )
                cur += '.' + cls.split(/[\s\n]+/).join('.');

                // Recurse up the DOM.
                return this.parent().getPath( ' > ' + cur + path );
            }
        });

    </script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
</head>
<body>
<div class="container" style="width: 500px;padding: 100px">
    <div id="first" class="page" role="form">
        <h2>First Content</h2>
        <p>
            Rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae
            dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut.
        </p>
        <p>
            Rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae
            dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut.
        </p>
        <p>
            Rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae
            dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut.
        </p>
        <p>
            Rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae
            dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut.
        </p>
        <div class="form-group">
            <label for="p1-email">Email address</label>
            <input type="email" class="form-control" id="p1-email" placeholder="Enter email">
        </div>
        <div class="form-group">
            <label for="p1-password">Password</label>
            <input type="password" class="form-control" id="p1-password" placeholder="Password">
        </div>
        <div class="checkbox">
            <label>
                <input type="checkbox"> Check me out
            </label>
        </div>
        <a id='p1-first'  class="btn btn-default" href="#first">Prev</a>
        <a id='p1-second' class="btn btn-primary" href="#second">Next</a>
    </div>
    <div id="second" class="page" role="form">
        <h2>Second Content</h2>
        <p>
            Rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae
            dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut.
        </p>
        <p>
            Rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae
            dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut.
        </p>
        <p>
            Rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae
            dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut.
        </p>
        <p>
            Rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae
            dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut.
        </p>
        <div class="form-group">
            <label for="p2-email">Email address</label>
            <input type="email" class="form-control" id="p2-email" placeholder="Enter email">
        </div>
        <div class="form-group">
            <label for="p2-password">Password</label>
            <input type="password" class="form-control" id="p2-password" placeholder="Password">
        </div>
        <div class="checkbox">
            <label>
                <input type="checkbox"> Check me out
            </label>
        </div>
        <a id='p2-first' class="btn btn-default" href="#first">Prev</a>
        <a id='p2-second'  class="btn btn-primary" href="#second">Next</a>
    </div>
    <script>
        function navigate(id){
            $('.page').hide();
            $(id).show();
        }
        $(window).on('load',function(){
            var host = window.location.hash=='#host';
            window.ws = new WebSocket("ws://"+window.location.hostname+":8081")
            window.ws.id = Math.random();

            function onScroll(e){
                window.ws.send(JSON.stringify([window.ws.id,1,$(window).scrollTop(),$(window).scrollLeft()]));
            }
            function onClick(e){
                if($(e.target).attr('id')){
                    var msg = JSON.stringify([window.ws.id,2,$(e.target).attr('id')])
                    console.info(msg);
                    window.ws.send(msg);
                }
            }
            function onChange(e){
                if($(e.target).attr('id')){
                    var msg = JSON.stringify([window.ws.id,3,$(e.target).attr('id'),$(e.target).val()])
                    console.info(msg);
                    window.ws.send(msg);
                }
            }
            window.ws.onopen = function () {
                console.log("Connection opened");
                if(host){
                    $( window ).bind("scroll" ,onScroll);
                    $('*').bind("click" ,onClick);
                    $('*').bind("change keyup" ,onChange);
                }
            };
            window.ws.onclose = function () {
                console.log("Connection closed")
            };
            window.ws.onerror = function () {
                console.error("Connection error")
            };
            window.ws.onmessage = function (event) {
                var msg = JSON.parse(event.data);
                if(!host) {
                    if (msg[0] != window.ws.id) {
                        switch (msg[1]) {
                            case 1 :
                                $(window).scrollTop(msg[2]);
                                $(window).scrollLeft(msg[3]);
                                break;
                            case 2 :
                                console.info(msg[2]);
                                document.getElementById(msg[2]).click();
                                break;
                            case 3 :
                                console.info(msg[2]);
                                $('#'+msg[2]).val(msg[3]);
                                break;
                        }
                    } else {
                        //console.info("Mine "+event.data);
                    }
                }
            };
            navigate(window.location.hash = '#first');
        });
        $(window).on('hashchange', function(e) {
           navigate(window.location.hash)
        });




    </script>

    <script>
        window.addEventListener("load", function () {



        })
    </script>
</div>

</body>
</html>